# Distribution image  #######################
#MACHINE = "imx53qsb"
#MACHINE = "qemux86"
MACHINE = "qemux86-64"
SDKMACHINE = "x86_64"
DISTRO = "poky"
USER_CLASSES = "buildstats image-mklibs image-prelink"
PATCHRESOLVE = "noop"

IMAGE_FSTYPES = "wic.vmdk tar.gz"

#PACKAGE_CLASSES = "package_ipk"
#PACKAGE_CLASSES = "package_deb"
#PACKAGE_CLASSES = "package_rpm"

TCLIBC = "glibc"
#TCLIBC = "musl"
#TCLIBC = "newlib"
#TCLIBC = "baremetal"

DL_DIR = "/home/build/downloads-sumo"

# Download and compile threads ################
BB_NUMBER_THREADS = "10"
PARALLEL_MAKE = "-j 4"

# Build Optimization #######################
BUILD_DEBUG="0"
#SELECTED_OPTIMIZATION="-O2 -pipe ${DEBUG_FLAGS}"
#SELECTED_OPTIMIZATION="-O2 -pipe"
SELECTED_OPTIMIZATION=" -Os -pipe"

# Disable sdl ############################
PACKAGECONFIG_remove_pn-qemu-native = " sdl"
PACKAGECONFIG_remove_pn-nativesdk-qemu = " sdl"

####################################
CONF_VERSION = "1"
ACCEPT_FSL_EULA = "1"
####################################

# Disk Space Monitoring during the build ###########
BB_DISKMON_DIRS ??= "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    STOPTASKS,/tmp,100M,100K \
    ABORT,${TMPDIR},100M,1K \
    ABORT,${DL_DIR},100M,1K \
    ABORT,${SSTATE_DIR},100M,1K \
    ABORT,/tmp,10M,1K"
    
# Distribution configuration ###################
DISTRO_FEATURES="${DISTRO_FEATURES_DEFAULT} ${DISTRO_FEATURES_LIBC} ${POKY_DEFAULT_DISTRO_FEATURES} ${DISTRO_FEATURES_LIBC}"
DISTRO_FEATURES_remove = " bluetooth bluez5 irda pcmcia pci nfc"
DISTRO_FEATURES_remove = " wifi nfs"
DISTRO_FEATURES_remove = " pulseaudio wayland vulkan"
DISTRO_FEATURES_append = " glib udev dbus zeroconf 3g alsa sql-sqlite openssl opengl gl x11 xcb xkb xcb-xinput xkbcommon"
DISTRO_FEATURES_append = " opengl gl"

# Use systemd for system initialization
DISTRO_FEATURES_remove = " sysvinit"
DISTRO_FEATURES_append = " systemd"
DISTRO_FEATURES_BACKFILL_CONSIDERED += "sysvinit"
VIRTUAL-RUNTIME_login_manager = "shadow-base"
VIRTUAL-RUNTIME_init_manager = "systemd"
VIRTUAL-RUNTIME_initscripts = "systemd-compat-units"

# Replace busybox
#PREFERRED_PROVIDER_virtual/base-utils = "coreutils"
#VIRTUAL-RUNTIME_base-utils = "coreutils"
#VIRTUAL-RUNTIME_base-utils-hwclock = "util-linux-hwclock"
#VIRTUAL-RUNTIME_base-utils-syslog = ""

# Locale configuration
DISTRO_FEATURES_LIBC_append=" libc-locales libc-locale-code"
DISTRO_FEATURES_append=" ${DISTRO_FEATURES_LIBC}"
GLIBC_GENERATE_LOCALES = "en_US.UTF-8 ru_RU.UTF-8"
IMAGE_LINGUAS = "en-us ru-ru"
# (Useful if the target device has 64Mbytes of RAM or less)
ENABLE_BINARY_LOCALE_GENERATION = "1"

#KERNEL_IMAGETYPE = "uImage"
#KERNEL_IMAGETYPE = "zImage"

# Packages configuration #
# DBus
#PACKAGECONFIG_pn-dbus_remove="  systemd"
PACKAGECONFIG_pn-dbus_append="  systemd"
PACKAGECONFIG_pn-dbus_append="  x11 user-session"
# DBus-glib
PACKAGECONFIG_pn-dbus-glib_remove="  tests"

# Qt Base
PACKAGECONFIG_pn-qtbase_remove=" developer-build qml-debug sm tests examples tools accessibility jpeg ico gtk"
PACKAGECONFIG_pn-qtbase_remove=" mtdev cups journald"
PACKAGECONFIG_pn-qtbase_append=" release optimize-size dbus udev evdev widgets libs freetype glib fontconfig harfbuzz libpng gif zlib pcre sql-sqlite openssl"

PACKAGECONFIG_pn-qtbase_append=" iconv"
PREFERRED_PROVIDER_virtual/libiconv = "glibc"

#PACKAGECONFIG_pn-qtbase_append=" ltcg"

# Qt Base Graphics manager
PACKAGECONFIG_pn-qtbase_remove=" directfb linuxfb kms gbm"
PACKAGECONFIG_pn-qtbase_append=" xcb xkb xkbcommon-evdev"

# Qt Base OpenGL
PACKAGECONFIG_pn-qtbase_remove=" eglfs gl no-opengl"
PACKAGECONFIG_pn-qtbase_append=" gles2"

# Qt Base input
PACKAGECONFIG_pn-qtbase_remove=" tslib libinput"
PACKAGECONFIG_pn-qtbase_append=" xinput2"

# Qt declarative
PACKAGECONFIG_pn-qtdeclarative_remove=" examples tests qtxmlpatterns"
#PACKAGECONFIG_pn-qtdeclarative_append=" "

# Qt SerialPort
PACKAGECONFIG_pn-qtserialport_remove=" examples tests"
#PACKAGECONFIG_pn-qtserialport_append=" "
    
# Qt Multimedia
PACKAGECONFIG_pn-qtmultimedia_remove=" pulseaudio openal"
PACKAGECONFIG_pn-qtmultimedia_append=" alsa gstreamer"

# Proftpd
PACKAGECONFIG_pn-proftpd_remove=" acl cap ctrls curses dso getopt nls pam pcre sendfile sia"
PACKAGECONFIG_pn-proftpd_append = " auth shadow ipv6 largefile openssl strip"

